#!/usr/bin/env python

# %matplotlib inline
import numpy as np
import xarray as xr
import pandas as pd


# from bokeh.plotting import figure
# from bokeh.io import output_notebook, show
# output_notebook()

import numpy as np
import matplotlib.pyplot as plt
from   mpl_toolkits.mplot3d import Axes3D
import os
import csv
import glob
from   datetime import datetime
import json
import copy
from scipy.interpolate import interp1d


from matplotlib import gridspec


# fn = 'all_data/reports_from_2020_09_22/report_of_2020_09_22_19_11_10.dat'
# fn = 'log_periodicities.csv'
# print(fn)

# ds = xr.open_dataset(fn)
# df = ds.to_dataframe()


def read_csv_file(fn, skipheader):
    '''
    Read a csv file (typically generated by an Orocos reporter) and
    stores its contents in a numpy array.
    For demonstrations, the first column (in the file and in the matrix) corresponds to time, the
    other columns to the different degrees of freedom.
    NOTE skipheader corresponds to the number of rows that belong to the header
    '''
    data = []
    header = []
    i=0
    with open(fn,'rb') as csvfile:
        freader = csv.reader(csvfile,delimiter=' ',skipinitialspace=True)
        for row in freader:
            i=i+1
            if i > skipheader:
                #print '=>',', '.join(row)
                if len(row)>1:
		    if row[-1]== '':
		      data.append( [float(e) for e in row[:-1] ])
		    else:
		      data.append( [float(e) for e in row])
	    else:
	      header.append(row)
    return np.array( data ), header



# data, header = read_csv_file('all_data/reports_from_2020_09_23/report_of_2020_09_23_18_52_01.dat', 1)
# data2, header2 = read_csv_file('all_data/reports_from_2020_09_23/report_of_2020_09_23_18_53_21.dat', 1)
# cut_data = 5

data, header = read_csv_file('all_data/reports_from_2020_10_01/report_of_2020_10_01_18_27_52.dat', 1)
data2, header2 = read_csv_file('all_data/reports_from_2020_10_01/report_of_2020_10_01_18_27_52.dat', 1)
cut_data = 5

data = data[cut_data:-1]
data2 = data2[cut_data:-1]

fig3 = plt.figure(3,figsize=[12.8,9.6])
ax1 = fig3.add_subplot(211)
ax2 = fig3.add_subplot(212,sharex=ax1)


ax1.plot(data[:,header[0].index('TimeStamp')],data[:,header[0].index('kin.periodicity')])
ax1.set_ylabel('Periodicity [ms]')
ax1.set_title('Periodicity priority=0 (max:  ' + str(max(data[:,header[0].index('kin.periodicity')])) +  ' ms)')

ax2.plot(data2[:,header2[0].index('TimeStamp')],data2[:,header2[0].index('kin.periodicity')])
ax2.set_ylabel('Periodicity [ms]')
ax2.set_title('Periodicity priority=99 (max:  ' + str(max(data2[:,header2[0].index('kin.periodicity')])) +  ' ms)')

# ax2.plot(data[:,header[0].index('periodicities')])
# ax2.set_ylabel('Periodicity [ms]')
# ax2.set_title('Periodicity (max:  ' + str(max(data[:,header[0].index('periodicities')])) +  ' ms)')



plt.show(block=False)
